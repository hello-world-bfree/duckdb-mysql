# name: test/sql/federation_types.test
# description: Test filter pushdown with various MySQL data types
# group: [sql]

require mysql_scanner

require-env MYSQL_TEST_DATABASE_AVAILABLE

statement ok
SET GLOBAL mysql_experimental_filter_pushdown=true;

statement ok
ATTACH 'host=localhost user=root port="0" database="mysqlscanner"' AS s1 (TYPE MYSQL_SCANNER)

# ==============================================================================
# Integer Type Filter Pushdown (using existing test tables)
# ==============================================================================

# Test 1: Filter on TINYINT
query I
SELECT COUNT(*) FROM s1.signed_integers WHERE t = 127
----
1

# Test 2: Filter on BIGINT
query I
SELECT COUNT(*) FROM s1.signed_integers WHERE b = -9223372036854775808
----
1

# Test 3: Range filter on integers
query I
SELECT COUNT(*) FROM s1.signed_integers WHERE i > 0
----
1

# ==============================================================================
# Decimal Type Filter Pushdown
# ==============================================================================

# Test 4: Decimal equality
query I
SELECT COUNT(*) FROM s1.decimals WHERE xs = 0.5
----
1

# Test 5: Decimal comparison
query I
SELECT COUNT(*) FROM s1.decimals WHERE m > 0
----
1

# ==============================================================================
# DateTime Type Filter Pushdown
# ==============================================================================

# Test 6: DATE filter
query I
SELECT COUNT(*) FROM s1.datetime_tbl WHERE d = DATE '2020-02-03'
----
1

# Test 7: DATE range filter
query I
SELECT COUNT(*) FROM s1.datetime_tbl WHERE d >= DATE '2020-01-01'
----
2

# Test 8: DATETIME filter (2029-02-14 and 9999-12-31 match)
query I
SELECT COUNT(*) FROM s1.datetime_tbl WHERE date_time >= TIMESTAMP '2029-01-01'
----
2

# Test 9: TIMESTAMP filter
query I
SELECT COUNT(*) FROM s1.datetime_tbl WHERE ts > TIMESTAMP '2000-01-01'
----
2

# ==============================================================================
# Boolean Type Filter Pushdown
# ==============================================================================

# Test 10: Boolean true filter
query I
SELECT COUNT(*) FROM s1.booleans WHERE b = true
----
1

# Test 11: Boolean false filter
query I
SELECT COUNT(*) FROM s1.booleans WHERE b = false
----
1

# Test 12: Boolean IS NULL
query I
SELECT COUNT(*) FROM s1.booleans WHERE b IS NULL
----
1

# ==============================================================================
# String/Text Type Filter Pushdown
# ==============================================================================

# Test 13: VARCHAR equality
query I
SELECT COUNT(*) FROM s1.text_tbl WHERE v = 'ab  '
----
1

# Test 14: Unicode string filter
query I
SELECT COUNT(*) FROM s1.text_tbl WHERE v = 'ðŸ¦†'
----
1

# Test 15: Empty string filter
query I
SELECT COUNT(*) FROM s1.text_tbl WHERE v = ''
----
1

# Test 16: TEXT IS NULL
query I
SELECT COUNT(*) FROM s1.text_tbl WHERE t IS NULL
----
1

# ==============================================================================
# BLOB Type Filter Pushdown
# ==============================================================================

# Test 17: BLOB equality
query I
SELECT COUNT(*) FROM s1.blob_tbl WHERE bl = BLOB '\x80'
----
1

# Test 18: BLOB IS NULL
query I
SELECT COUNT(*) FROM s1.blob_tbl WHERE bl IS NULL
----
1

# ==============================================================================
# Floating Point Filter Pushdown
# ==============================================================================

# Test 19: FLOAT equality
query I
SELECT COUNT(*) FROM s1.floating_points WHERE f = 0.5
----
1

# Test 20: DOUBLE comparison
query I
SELECT COUNT(*) FROM s1.floating_points WHERE d > 0
----
1

# Test 21: FLOAT IS NULL
query I
SELECT COUNT(*) FROM s1.floating_points WHERE f IS NULL
----
1

# ==============================================================================
# Enum Type Filter Pushdown
# ==============================================================================

# Test 22: ENUM equality
query I
SELECT COUNT(*) FROM s1.enum_tbl WHERE size = 'medium'
----
1

# Test 23: ENUM IN clause
query I
SELECT COUNT(*) FROM s1.enum_tbl WHERE size IN ('small', 'large')
----
2

# ==============================================================================
# Year Type Filter Pushdown
# ==============================================================================

# Test 24: YEAR comparison
query I
SELECT COUNT(*) FROM s1.datetime_tbl WHERE y >= 2000
----
2
